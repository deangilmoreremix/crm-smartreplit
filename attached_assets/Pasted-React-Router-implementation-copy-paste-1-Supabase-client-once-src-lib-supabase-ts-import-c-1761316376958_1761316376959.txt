React Router implementation (copy-paste)
1) Supabase client (once)
// src/lib/supabase.ts
import { createClient } from '@supabase/supabase-js';

export const supabase = createClient(
  import.meta.env.VITE_SUPABASE_URL!,
  import.meta.env.VITE_SUPABASE_ANON_KEY!
);

2) Routes
// src/main.tsx (or your router setup)
import { createBrowserRouter, RouterProvider } from 'react-router-dom';
import AuthCallback from './pages/auth/Callback';
import Recovery from './pages/auth/Recovery';
import App from './App';

const router = createBrowserRouter([
  { path: '/', element: <App /> },
  { path: '/auth/callback', element: <AuthCallback /> },
  { path: '/auth/recovery', element: <Recovery /> },
]);

export default function Root() {
  return <RouterProvider router={router} />;
}

3) /auth/callback page (generic handler)
// src/pages/auth/Callback.tsx
import { useEffect, useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { supabase } from '../../lib/supabase';

export default function AuthCallback() {
  const [msg, setMsg] = useState('Verifying link…');
  const navigate = useNavigate();

  useEffect(() => {
    (async () => {
      try {
        // accept both hash tokens and code param
        const hash = window.location.hash.slice(1);
        const hp = new URLSearchParams(hash);
        const access = hp.get('access_token');
        const refresh = hp.get('refresh_token');

        const qs = new URLSearchParams(window.location.search);
        const code = qs.get('code');            // OTP/code-based flows
        const type = qs.get('type') || hp.get('type'); // e.g., 'recovery', 'signup'

        if (code) {
          await supabase.auth.exchangeCodeForSession(code);
        } else if (access) {
          await supabase.auth.setSession({ access_token: access, refresh_token: refresh ?? '' } as any);
        }

        // Route based on flow
        if (type === 'recovery') {
          navigate('/auth/recovery', { replace: true });
        } else {
          navigate('/dashboard', { replace: true }); // or wherever you want landing
        }
      } catch (e: any) {
        console.error(e);
        setMsg('Link is invalid or expired. Request a new one.');
      }
    })();
  }, [navigate]);

  return <p style={{ textAlign:'center', marginTop: 40 }}>{msg}</p>;
}

4) /auth/recovery page (password reset UI)
// src/pages/auth/Recovery.tsx
import { useEffect, useState } from 'react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';

export default function Recovery() {
  const [ready, setReady] = useState(false);
  const [password, setPassword] = useState('');
  const [msg, setMsg] = useState('');
  const navigate = useNavigate();

  useEffect(() => {
    (async () => {
      try {
        // Make sure session is established for BOTH styles
        const hash = window.location.hash.slice(1);
        const hp = new URLSearchParams(hash);
        const access = hp.get('access_token');
        const refresh = hp.get('refresh_token');

        const qs = new URLSearchParams(window.location.search);
        const code = qs.get('code');

        if (code) {
          await supabase.auth.exchangeCodeForSession(code);
        } else if (access) {
          await supabase.auth.setSession({ access_token: access, refresh_token: refresh ?? '' } as any);
        }

        setReady(true);
      } catch (e: any) {
        console.error(e);
        setMsg('Recovery link is invalid or expired. Request a new one.');
      }
    })();
  }, []);

  const onSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setMsg('');
    const { error } = await supabase.auth.updateUser({ password });
    if (error) setMsg(`⚠️ ${error.message}`);
    else {
      setMsg('✅ Password updated. Redirecting to sign-in…');
      setTimeout(() => navigate('/login', { replace: true }), 1500);
    }
  };

  if (!ready) return <p style={{ textAlign:'center', marginTop: 40 }}>Preparing secure reset…</p>;

  return (
    <form onSubmit={onSubmit} style={{ maxWidth: 420, margin: '48px auto', textAlign: 'center' }}>
      <h1>Set a New Password</h1>
      <input
        type="password"
        placeholder="New password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        style={{ width:'100%', padding:12, margin:'18px 0', borderRadius:8, border:'1px solid #e5e7eb' }}
        required
      />
      <button
        type="submit"
        style={{ background:'#16a34a', color:'#fff', padding:'12px 20px', borderRadius:8, border:'none', cursor:'pointer', width:'100%' }}
      >
        Update Password
      </button>
      {msg && <p style={{ marginTop:14 }}>{msg}</p>}
    </form>
  );
}

Next.js notes (if you’re on Next)

Pages Router: put files at pages/auth/callback.tsx and pages/auth/recovery.tsx. Replace react-router bits with useRouter from next/router and router.push(...).

App Router: put them at app/auth/callback/page.tsx and app/auth/recovery/page.tsx and use useRouter from next/navigation.

The core logic stays the same: exchange code or set session → redirect (callback) / show form (recovery).